
# ハードウェアについて
## ARMv7-M
### レジスタ
- R0 から R15 までのレジスタが使用可
- R0 から R12 ... 汎用レジスタ
- R13 ... スタックポインタ (SP)
- R14 ... リンクレジスタ (LR)
- R15 ... プログラムカウンタ (PC)
- PSR

### メモリーマップドIO
- コントロールレジスタ（CSR）
- リロードバリューレジスタ（RVR）
- カレントバリューレジスタ（CVR）
- キャリブレーションバリューレジスタ（CALIB)


#
https://docs.rust-embedded.org/embedonomicon/memory-layout.html

# 実行コマンド
cargo build --target thumbv7em-none-eabihf

RUSTFLAGS="-C link-args=-Tlink.ld" cargo build --target thumbv7em-none-eabihf

- cargo hf2 ... フラッシュROMにプログラムを書き込む

# 設定ファイルなど
- rust-toolchain ... rustupへどのバージョンのRustを使えばいいかを教えてくれる。

- .cargo/config ... コマンドラインオプションを定義することで、実行時は省略可能。

# プログラムの構成
- Cargo ... パッケージマネージャ。各パッケージやパッケージのバージョンや依存性を管理。
- パッケージ...トップレベル クレートの集合。
- クレート...実行バイナリ、実行バイナリから使用されるライブラリ群。モジュールの集合。
- モジュール...アトリビュートや関数の集合。

# 構文
## マクロ
- vec! や println! で、コンパイル前に実行される一連の処理。 

## 所有権と参照、ミュータブル
混在利用は不可。
- & -> つけることで借用(仮の所有権を作成)となり、既存の変数を参照する（もとの変数の束縛は解除されない）。参照ポインタを表す。
- mut -> つけることで変更可能となる。つけなければ読み取り専用。初期化・最初の束縛後変更できず。
- &mut -> つけることで既存の変数を参照した上で変更可能となる。
- * ポインタの参照外し


### rawポインタ
制限が少ないポインタ。グラフ構造など。
- *const T ... 読込み
- *mut T ... 読書き


## アトリビュート
アイテム宣言にメタデータを付与する構文。

### クレートレベル
- #![no_std] ...
- OSの標準機能のstdクレートを利用せず、独自のランタイムを利用する場合
  - コンパイルや独自の初期化
  - 実行フォーマット定義などが行えるアトリビュート。（OSのカーネル、ファームウェア、ブートローダなど）

- #![no_main] ... main関数を使わないプログラム。

- core  ...プリミティブなデータ型や操作、アトミックな命令を取り扱うstdクレートのサブセット。


### 関数レベル
- #[panic_handler] ... パニック発生時の動作を定義する関数に付与する。以下のパニック両方が対象。
  - ライブラリレベル
  - 言語レベル

- #[no_mangle] ... Rustコンパイル時にリンカースクリプト内で変数や関数名称を別のシンボルに置き換えないようにする。